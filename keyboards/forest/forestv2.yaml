units:
  X: 0.9 # Extrusion width
  B: 3*X
  stagger: 0.25
  bb: 7 # bind base
  ColStagger: 1U
  ColSpread: 1U + 4
  mcu_height: 34
  mcu_width: 18
    # distance keys to mcu
  mcu_padding: 1.5
  switchplate_switch_cutout: 14
points:
  key:
    bind: [B, B, B, B]
    tags.1u: true
    #bind: [bb,bb,bb,bb]
  zones:
    fingers:
      anchor:
        shift: [100, -100]
      columns:
        col_one:
          key:
          rows:
            thumb:
              skip: true
            bottom:
              skip: true
            asdf:
            qwerty:
            numbers:
        col_two:
          key:
            stagger: ColStagger / 2
            #spread: ColSpread - 3
          rows:
            thumb:
              skip: true
            bottom:
            asdf:
            qwerty:
            numbers:
        col_three:
          key:
            stagger: ColStagger / 5
            spread: ColSpread
          rows:
            thumb:
              skip: true
            bottom:
            asdf:
            qwerty:
            numbers:
        col_four:
          key:
            stagger: ColStagger - 10
            spread: ColSpread
          rows:
            thumb:
              skip: true
            bottom:
            asdf:
            qwerty:
            numbers:
        col_five:
          key:
            stagger: ColStagger - 25
            spread: ColSpread
          rows:
            thumb:
              skip: true
            bottom:
            asdf:
            qwerty:
            numbers:
        col_six:
          key:
            stagger: ColStagger - 19
            spread: ColSpread
          rows:
            thumb:
            bottom:
            asdf:
            qwerty:
            numbers:
      rows:
        thumb:
        bottom:
        asdf:
        qwerty:
        numbers:
    thumbfan:
      anchor:
        ref: fingers_col_six_thumb
        shift: [1U + 2, -0.5U]
      columns:
        home:
          key:
            splay: -29
            origin: [0.1U, -0.5U]
          rows:
            thumb:
              shift: [2, 0U]
              #height: 1.5u
              spread: ColSpread
        far:
          key:
            splay: -5
          rows:
            thumb:
              shift: [4, 0U]
              spread: ColSpread 
              #height: 1.5u
      rows:
        thumb:
    mcu:
      anchor:
        ref: fingers_col_six_numbers
      columns:
        mcu:
          key:
            tags: [mcu]
            width: mcu_height  # footprint width/height unintuitive
            height: mcu_width
            rotate: -90
            shift: [mcu_padding, -mcu_width/2-0.3]
outlines:
  _switch_holes:
    - what: rectangle
      where: true
      size: 14
      bound: false
  _switch_clips:
    - what: rectangle
      where: true
      size: [5, 16]
      bound: false
  _keys:
    - what: rectangle
      where: true
      size: 18
      bound: false
  plate:
    - what: rectangle
      where: true
      bound: true
      size: 1U
      corner: .5
  _plate_col_six_2:
    - what: rectangle
      where: true
      bound: true
      size: 1U - 2 * 2X
      corner: .5
  _plate_col_six_3:
    - what: rectangle
      where: true
      bound: true
      size: 1U - 2 * 3X
      corner: .5
  _rpi_pico:
    - what: rectangle
      adjust:
        ref: fingers_col_six_qwerty
        shift: [0.5U+B+3+21/2, 0.5U + 3 - 51/2 - 0.5]
      size: [21, 51]
  _usb_cutout:
    - what: rectangle
      adjust:
        ref: fingers_col_six_qwerty
        shift: [0.5U+B+3 + 21.0/2, 0.5U + 3  -1X + 5X/2]
      size: [8, 5X]
  _jst_cutout:
    - what: rectangle
      adjust:
        ref: fingers_col_six_qwerty
        shift: [0.5U+B+3 + 21 + 0.5 - 1X + 5X/2, 0.5U - 51 + 1 - 11/2]
      size: [5X, 11]
  _jst_socket:
    - what: rectangle
      adjust:
        ref: fingers_col_six_qwerty
        shift: [0.5U+B+3 + 21 + 0.5 - 7/2, 0.5U - 51 +  1 - 11 - 0.65 + 12.3/2]
      size: [7, 12.3]
  _led_cutout:
    - what: rectangle
      adjust:
        ref: fingers_col_six_qwerty
        shift: [0.5U+B+3 + 21.0/2, 0]
      size: [5.5, 5.5]
  _touchpad_cutout:
    - what: rectangle
      adjust:
        ref: fingers_col_six_asdf
        shift: [0.5U + 6 + 5/2, 0]
      size: [5, 15]
  _posts_template:
    $params: [__r__]
    numbers_left:
      what: circle
      adjust:
        ref: fingers_col_one_numbers
        shift: [0.5U, -0.5U]
      radius: __r__
    numbers_right:
      what: circle
      adjust:
        ref: fingers_col_six_qwerty
        shift: [0.5U+2, 0U]
      radius: __r__
    bottom_left:
      what: circle
      adjust:
        ref: fingers_col_one_asdf
        shift: [0.5U, 0.5U]
      radius: __r__
    bottom_right:
      what: circle
      adjust:
        ref: fingers_col_six_thumb
        shift: [0.5U+2, 0.5U]
      radius: __r__
  _posts:
    $extends: outlines._posts_template
    $args: [2.6]
  _screw_holes:
    $extends: outlines._posts_template
    $args: [0.8]
  _lid_bosses:
    $extends: outlines._posts_template
    $args: [3.5]
  _lid_screw_heads:
    $extends: outlines._posts_template
    $args: [2.4]
  case_top:
    - what: outline
      name: plate
      fillet: 2
    - what: outline
      name: _switch_holes
      operation: subtract
  board_outline:
    - what: polygon
      operation: stack
      fillet: 7
      points:
        - ref: fingers_col_one_numbers
          shift: [-0.6u,0.5U]
        - ref: fingers_col_two_numbers
          shift: [-0.6U,0.5U]
        - ref: fingers_col_three_numbers
          shift: [-0.8U,0.6U]
        - ref: fingers_col_four_numbers
          shift: [-0.4U,0.7U]
        - ref: fingers_col_six_numbers
          shift: [0.5U,0.7U]
        # - ref: fingers_col_six_numbers
        #   shift: [0.5+mcu_padding+mcu_width+0.25, 0.5]  
        # - ref: fingers_col_six_bottom
        #   shift: [0.5+mcu_padding+mcu_width+0.25, -0.5]
        - ref: thumbfan_far_thumb
          shift: [0.5U,0.5U]
        - ref: thumbfan_home_thumb
          shift: [1U,-0.9U]
        - ref: fingers_col_six_thumb
          shift: [-0.5U,-0.6U]
        - ref: fingers_col_five_bottom
          shift: [-1U,-0.5U]
        - ref: fingers_col_four_bottom
          shift: [-1U,-1U]
        - ref: fingers_col_three_bottom
          shift: [-1U,-1U]
        - ref: fingers_col_two_bottom
          shift: [-1U,-1U]
        - ref: fingers_col_one_asdf
          shift: [-0.5U,-0.9U]
  
  combo:
    - what: outline
      name: board_outline
      operation: stack
    - what: outline
      name: plate
      operation: stack
    - what: outline
      name: _switch_holes
      operation: subtract
  case_wall:
    - what: outline
      name: plate
    - what: outline
      name: _plate_col_six_3
      operation: subtract
  case_lip:
    - what: outline
      name: plate
    - what: outline
      name: _plate_col_six_2
      operation: subtract
  preview:
    - what: outline
      name: plate
    - what: outline
      name: _keys
      operation: stack
    - what: outline
      name: _switch_holes
      operation: stack
    - what: outline
      name: _switch_clips
      operation: stack
    - what: outline
      name: _rpi_pico
      operation: stack
    - what: outline
      name: _usb_cutout
      operation: stack
    - what: outline
      name: _jst_cutout
      operation: stack
    - what: outline
      name: _jst_socket
      operation: stack
    - what: outline
      name: _led_cutout
      operation: stack
    - what: outline
      name: _touchpad_cutout
      operation: stack
    - what: outline
      name: _posts
      operation: stack
    - what: outline
      name: _lid_bosses
      operation: stack
    # wall
    - what: outline
      name: _plate_col_six_3
      operation: stack
cases:
  _body:
    # switch is 8.3 mm deep
    # plate is 2mm
    # case is 6.0mm
    # lid is 1.6mm
    # total 10mm depth, 8.4mm col_six
    - name: case_lip
      extrude: 1.6
    - name: case_wall
      extrude: 6.1
      shift: [0, 0, 1.6]
    - name: case_top
      extrude: 2
      shift: [0, 0, 6 + 1.6]
    - name: _switch_clips
      extrude: 1
      shift: [0, 0, 6 + 1.6]
      operation: subtract
    - name: _posts
      extrude: 6 - 1.6
      shift: [0, 0, 3.2]
    - name: _screw_holes
      extrude: 6 - 1.6
      shift: [0, 0, 3.2]
      operation: subtract
    - name: _usb_cutout
      extrude: 3.6
      shift: [0, 0, 2.2]
      operation: subtract
    - name: _jst_cutout
      extrude: 5.2
      shift: [0, 0, 6+1.6 - 5.2]
      operation: subtract
  _body2:
    # switch is 8.3 mm deep
    # plate is 2mm
    # case is 6.0mm
    # lid is 1.6mm
    # total 10mm depth, 8.4mm col_six
    - name: case_lip
      extrude: 1.6
    - name: case_wall
      extrude: 6.1
      shift: [0, 0, 1.6]
    - name: combo
      extrude: 2
      shift: [0, 0, 6 + 1.6]
    - name: _switch_clips
      extrude: 1
      shift: [0, 0, 6 + 1.6]
      operation: subtract
    - name: _posts
      extrude: 6 - 1.6
      shift: [0, 0, 3.2]
    - name: _screw_holes
      extrude: 6 - 1.6
      shift: [0, 0, 3.2]
      operation: subtract
    - name: _usb_cutout
      extrude: 3.6
      shift: [0, 0, 2.2]
      operation: subtract
    - name: _jst_cutout
      extrude: 5.2
      shift: [0, 0, 6+1.6 - 5.2]
      operation: subtract
  
  body:
    - name: _body
      what: case
  body2:
  - name: _body2
    what: case
  # body_led:
  #   - name: _body
  #     what: case
  #   - name: _led_cutout
  #     extrude: 2.2
  #     shift: [0, 0, 6 + 1.6 - 0.1]
  #     operation: subtract
  # body_tp:
  #   - name: _body
  #     what: case
  #   - name: _touchpad_cutout
  #     extrude: 2.2
  #     shift: [0, 0, 6 + 1.6 - 0.1]
  #     operation: subtract
  lid:
    - name: _plate_col_six_2
      extrude: 1.6
    - name: _lid_bosses
      extrude: 1.6
      shift: [0, 0, 1.6]
    - name: _screw_holes
      extrude: 1.8
      shift: [0, 0, 1.5]
      operation: subtract
    - name: _lid_screw_heads
      extrude: 1.8
      shift: [0, 0, -0.1]
      operation: subtract
