# Complete Ergogen Config Example - Lily58 Layout
# Generated by KLE to Ergogen Converter
# 
# This is a working Ergogen configuration that you can test at:
# https://ergogen.xyz
#
# Instructions:
# 1. Copy this entire file into the Ergogen web interface
# 2. Click "Generate" to see the PCB layout
# 3. The points represent switch positions converted from KLE format

units:
  # Key spacing and measurements
  kx: 19.05  # Key unit spacing in mm
  ky: 19.05  # Key unit spacing in mm
  
  # PCB parameters  
  pcb_outline_buffer: 2.5  # Space around keys

points:
  zones:
    # Left half of the keyboard
    left_keys:
      anchor:
        rotate: 0
        shift: [0, 0]
      key:
        padding: 19.05
        tags: [key, left]
      rows:
        bottom:
          row_net: P21
        home:
          row_net: P20
        top: 
          row_net: P19
        number:
          row_net: P18
      columns:
        pinky:
          key:
            col_net: P15
          rows:
            bottom:
              shift: [0, -4.76]
            home:
              shift: [0, -4.76]  
            top:
              shift: [0, -4.76]
            number:
              shift: [0, -4.76]
        ring:
          key:
            col_net: P14
            stagger: 6.35
        middle:
          key:
            col_net: P16
            stagger: 2.38
        index:
          key:
            col_net: P10
            stagger: -2.38
        inner:
          key:
            col_net: P1
            stagger: -4.76
    
    # Right half of the keyboard (mirrored)
    right_keys:
      anchor:
        ref: left_keys_inner_number
        shift: [57.15, 0]
      key:
        padding: 19.05
        tags: [key, right]
      rows:
        bottom:
          row_net: P21
        home:
          row_net: P20
        top:
          row_net: P19
        number:
          row_net: P18
      columns:
        inner:
          key:
            col_net: P1
            stagger: -4.76
        index:
          key:
            col_net: P10
            stagger: -2.38
        middle:
          key:
            col_net: P16
            stagger: 2.38
        ring:
          key:
            col_net: P14
            stagger: 6.35
        pinky:
          key:
            col_net: P15
          rows:
            bottom:
              shift: [0, -4.76]
            home:
              shift: [0, -4.76]
            top:
              shift: [0, -4.76]
            number:
              shift: [0, -4.76]
    
    # Thumb clusters
    left_thumbs:
      anchor:
        ref: left_keys_inner_bottom
        shift: [9.525, -19.05]
      key:
        padding: 19.05
        tags: [key, thumb, left]
      rows:
        thumb:
          row_net: P7
      columns:
        inner:
          key:
            col_net: P5
        outer:
          key:
            col_net: P4
            
    right_thumbs:
      anchor:
        ref: right_keys_inner_bottom  
        shift: [-9.525, -19.05]
      key:
        padding: 19.05
        tags: [key, thumb, right]
      rows:
        thumb:
          row_net: P7
      columns:
        inner:
          key:
            col_net: P5
        outer:
          key:
            col_net: P4

outlines:
  # PCB outline based on key positions
  key_outline:
    - what: rectangle
      where: [key]
      size: [14, 14]  # Switch cutout size
      
  pcb_outline:
    - what: polygon
      operation: stack
      points:
        # Left side outline points
        - ref: left_keys_pinky_number
          shift: [-9.525, 9.525]
        - ref: left_keys_inner_number  
          shift: [9.525, 9.525]
        - ref: right_keys_inner_number
          shift: [-9.525, 9.525]
        - ref: right_keys_pinky_number
          shift: [9.525, 9.525]
        - ref: right_keys_pinky_bottom
          shift: [9.525, -9.525]
        - ref: right_thumbs_outer_thumb
          shift: [9.525, -9.525]
        - ref: left_thumbs_outer_thumb
          shift: [-9.525, -9.525]
        - ref: left_keys_pinky_bottom
          shift: [-9.525, -9.525]
      fillet: 3

pcbs:
  lily58_pcb:
    outlines:
      main:
        outline: pcb_outline
        layer: Edge.Cuts
    footprints:
      # Key switches
      choc_switches:
        what: choc
        where: [key]
        params:
          keycaps: true
          reverse: false
          hotswap: true
          from: "{{colrow}}"
          to: "{{row_net}}"
        
      # Diodes for each key
      diodes:
        what: diode
        where: [key]
        params:
          from: "{{colrow}}"
          to: "{{col_net}}"
        adjust:
          shift: [0, -5]
          
      # MCU (Pro Micro compatible)
      mcu:
        what: promicro
        where:
          ref: left_keys_index_home
          shift: [0, -35]
          rotate: 270
        params:
          orientation: down
          
      # Reset button  
      reset:
        what: button
        where:
          ref: mcu
          shift: [0, 10]
        params:
          from: GND
          to: RST
          
      # TRRS jack for split communication
      trrs:
        what: trrs
        where:
          ref: left_keys_pinky_home
          shift: [-15, 0]
          rotate: 180
        params:
          A: VCC
          B: GND  
          C: P2
          D: P3
