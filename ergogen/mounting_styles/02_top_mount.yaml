# Top Mount Example - 2x2 Keyboard
# Plate secured to top housing via mounting tabs
# Better key response, consistent typing feel

meta:
  engine: 4.1.0
  name: top_mount_example
  version: 1.0

units:
  kx: 19.05
  ky: 19.05
  # Minimalistic parameters
  case_wall: 2.0
  case_height: 10
  tab_width: 6
  tab_height: 8

points:
  zones:
    matrix:
      key:
        padding: ky
        spread: kx
        tags: [key]
      columns:
        col0:
        col1:
      rows:
        row0:
        row1:

outlines:
  # PCB outline
  board:
    - what: polygon
      operation: stack
      fillet: 2
      points:
        - ref: matrix_col0_row0
          shift: [-10, -10]
        - ref: matrix_col1_row0
          shift: [10, -10]
        - ref: matrix_col1_row1
          shift: [10, 10]
        - ref: matrix_col0_row1
          shift: [-10, 10]

  # Switch plate with proper mounting tabs
  switch_plate:
    - what: outline
      name: board
      fillet: 1
    # Add mounting tabs extending from plate edges
    - what: rectangle
      where: matrix_col0_row0
      size: [tab_width, tab_height]
      adjust:
        shift: [-kx/2 - tab_width/2, 0]
      operation: add
    - what: rectangle
      where: matrix_col1_row0
      size: [tab_width, tab_height]
      adjust:
        shift: [kx/2 + tab_width/2, 0]
      operation: add
    # Switch cutouts
    - what: rectangle
      where: [key]
      size: [14, 14]
      operation: subtract
    # Tab mounting holes
    - what: circle
      where: matrix_col0_row0
      radius: 1.1
      adjust:
        shift: [-kx/2 - tab_width/2, 0]
      operation: subtract
    - what: circle
      where: matrix_col1_row0
      radius: 1.1
      adjust:
        shift: [kx/2 + tab_width/2, 0]
      operation: subtract

  # Minimalistic case outline
  case_outline:
    - what: outline
      name: board
      expand: case_wall
      fillet: 2

  # Top case with mounting bosses for tabs
  top_case:
    - what: outline
      name: case_outline
    # Add mounting bosses where tabs attach
    - what: rectangle
      where: matrix_col0_row0
      size: [tab_width + 2, tab_height + 2]
      adjust:
        shift: [-kx/2 - tab_width/2, 0]
      operation: add
    - what: rectangle
      where: matrix_col1_row0
      size: [tab_width + 2, tab_height + 2]
      adjust:
        shift: [kx/2 + tab_width/2, 0]
      operation: add
    # Mounting holes for screws
    - what: circle
      where: matrix_col0_row0
      radius: 1.1
      adjust:
        shift: [-kx/2 - tab_width/2, 0]
      operation: subtract
    - what: circle
      where: matrix_col1_row0
      radius: 1.1
      adjust:
        shift: [kx/2 + tab_width/2, 0]
      operation: subtract

cases:
  # Switch plate with tabs
  plate:
    - name: switch_plate
      extrude: 1.6

  # Minimalistic top mount case
  top_mount_case:
    # Bottom case
    - name: case_outline
      extrude: 1
    # Thin walls
    - name: case_outline
      extrude: case_height
    - name: board
      extrude: case_height
      operation: subtract
    # Top case with mounting bosses
    - name: top_case
      extrude: 2
      shift: [0, 0, case_height - 2]
      operation: add

pcbs:
  main:
    outlines:
      main:
        outline: board
