# Spring Mount Example - 2x2 Keyboard
# Springs provide cushioning between plate and case
# Dynamic response, sound dampening, unique typing feel

meta:
  engine: 4.1.0
  name: spring_mount_example
  version: 1.0

units:
  # Standard MX key spacing
  kx: 19.05
  ky: 19.05
  
  # Minimalistic case parameters
  case_wall: 2.0
  case_height: 10
  plate_thickness: 1.6
  
  # Spring parameters
  spring_diameter: 5
  spring_height: 3
  spring_well_depth: 4

points:
  zones:
    matrix:
      anchor:
        shift: [50, -50]
      key:
        padding: ky
        spread: kx
        tags: [key, switch]
      columns:
        col0:
          key.column_net: col0
        col1:
          key.column_net: col1
      rows:
        row0:
          row_net: row0
        row1:
          row_net: row1
    
    # Spring mounting points
    spring_points:
      anchor:
        ref: matrix_col0_row0
        shift: [-kx/2, ky/2]
      key:
        tags: [spring_mount]
      columns:
        spring_left:
        spring_right:
          key.shift: [kx, 0]
      rows:
        top_springs:
        bottom_springs:
          shift: [0, -ky]

outlines:
  # Plate with spring mounting posts
  switch_plate:
    - what: rectangle
      where: [switch]
      bound: true
      size: [kx, ky]
      fillet: 1
    # Switch cutouts
    - what: rectangle
      where: [switch]
      size: [14, 14]
      operation: subtract
    # Spring mounting posts on plate
    - what: circle
      where: [spring_mount]
      radius: 2  # Small post for spring centering
      operation: add
  
  # Case with spring wells
  case_bottom:
    - what: outline
      name: switch_plate
      expand: case_wall
      fillet: 2

  # Spring wells
  spring_wells:
    - what: circle
      where: [spring_mount]
      radius: spring_diameter/2 + 0.5

cases:
  # Plate with spring posts
  plate:
    - name: switch_plate
      extrude: 1.6

  # Spring mount case
  spring_mount_case:
    # Bottom case
    - name: case_bottom
      extrude: case_height
    # Spring wells
    - name: spring_wells
      extrude: spring_well_depth
      shift: [0, 0, case_height - spring_well_depth]
      operation: subtract
    
    # Minimalistic top case
    - name: case_bottom
      expand: -0.5
      extrude: 2
      shift: [0, 0, case_height - 2]
      operation: add

pcbs:
  spring_mount_pcb:
    outlines:
      main:
        outline: switch_plate
    footprints:
      switches:
        what: mx
        where: [switch]
        params:
          hotswap: true
          from: "{{column_net}}"
          to: "{{colrow}}"